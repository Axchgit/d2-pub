<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据持久化 | D2 Projects</title>
    <meta name="description" content="https://d2.pub">
    <link rel="icon" href="/logo@2x.png">
  <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?a4d73e21496377fe9f2ddb6b8c97440e";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();</script>
    
    <link rel="preload" href="/assets/css/0.styles.3aaf8dca.css" as="style"><link rel="preload" href="/assets/js/app.ad93a569.js" as="script"><link rel="preload" href="/assets/js/2.501740d6.js" as="script"><link rel="preload" href="/assets/js/21.9d0f9fd3.js" as="script"><link rel="prefetch" href="/assets/js/10.46530447.js"><link rel="prefetch" href="/assets/js/11.1114b2a9.js"><link rel="prefetch" href="/assets/js/12.e03e3be6.js"><link rel="prefetch" href="/assets/js/13.005dae61.js"><link rel="prefetch" href="/assets/js/14.acb71496.js"><link rel="prefetch" href="/assets/js/15.9e9d9f73.js"><link rel="prefetch" href="/assets/js/16.c9bfd1b2.js"><link rel="prefetch" href="/assets/js/17.d4f10201.js"><link rel="prefetch" href="/assets/js/18.c9402020.js"><link rel="prefetch" href="/assets/js/19.ea9b1445.js"><link rel="prefetch" href="/assets/js/20.907d9f95.js"><link rel="prefetch" href="/assets/js/22.3b5234bd.js"><link rel="prefetch" href="/assets/js/23.1fcd5700.js"><link rel="prefetch" href="/assets/js/24.b2c6a4a3.js"><link rel="prefetch" href="/assets/js/25.91943077.js"><link rel="prefetch" href="/assets/js/26.f598eaee.js"><link rel="prefetch" href="/assets/js/27.591212ef.js"><link rel="prefetch" href="/assets/js/28.a0108c67.js"><link rel="prefetch" href="/assets/js/29.60606d64.js"><link rel="prefetch" href="/assets/js/3.9f983c48.js"><link rel="prefetch" href="/assets/js/30.ac65dbf7.js"><link rel="prefetch" href="/assets/js/31.65a6dedf.js"><link rel="prefetch" href="/assets/js/32.a66c2525.js"><link rel="prefetch" href="/assets/js/33.67241be2.js"><link rel="prefetch" href="/assets/js/34.0a068881.js"><link rel="prefetch" href="/assets/js/35.64b068c9.js"><link rel="prefetch" href="/assets/js/36.db17dfc8.js"><link rel="prefetch" href="/assets/js/37.379dfe42.js"><link rel="prefetch" href="/assets/js/38.5fdcba75.js"><link rel="prefetch" href="/assets/js/39.3febc85e.js"><link rel="prefetch" href="/assets/js/4.771b6206.js"><link rel="prefetch" href="/assets/js/40.ea01e8b7.js"><link rel="prefetch" href="/assets/js/41.6e078ffb.js"><link rel="prefetch" href="/assets/js/42.eb06c61d.js"><link rel="prefetch" href="/assets/js/43.1ed8d07d.js"><link rel="prefetch" href="/assets/js/44.3c56e32f.js"><link rel="prefetch" href="/assets/js/45.f8ea0e94.js"><link rel="prefetch" href="/assets/js/46.a7684867.js"><link rel="prefetch" href="/assets/js/47.9aeb3a4c.js"><link rel="prefetch" href="/assets/js/48.7e5d0bf7.js"><link rel="prefetch" href="/assets/js/49.1070b53c.js"><link rel="prefetch" href="/assets/js/5.1deaeef4.js"><link rel="prefetch" href="/assets/js/50.ee15b619.js"><link rel="prefetch" href="/assets/js/51.9893da8d.js"><link rel="prefetch" href="/assets/js/52.8c406e59.js"><link rel="prefetch" href="/assets/js/53.34600a08.js"><link rel="prefetch" href="/assets/js/54.43610b21.js"><link rel="prefetch" href="/assets/js/55.153e88b5.js"><link rel="prefetch" href="/assets/js/56.e67f3582.js"><link rel="prefetch" href="/assets/js/57.d93848b1.js"><link rel="prefetch" href="/assets/js/58.f3ad088d.js"><link rel="prefetch" href="/assets/js/59.215e7d26.js"><link rel="prefetch" href="/assets/js/6.a607396c.js"><link rel="prefetch" href="/assets/js/60.5d0d1d05.js"><link rel="prefetch" href="/assets/js/61.688bd19a.js"><link rel="prefetch" href="/assets/js/62.9d4e22bc.js"><link rel="prefetch" href="/assets/js/63.5946677e.js"><link rel="prefetch" href="/assets/js/64.7131b72a.js"><link rel="prefetch" href="/assets/js/65.b01a7b1f.js"><link rel="prefetch" href="/assets/js/66.50a72479.js"><link rel="prefetch" href="/assets/js/67.1c279cf1.js"><link rel="prefetch" href="/assets/js/68.53e6e8ba.js"><link rel="prefetch" href="/assets/js/69.9625f58e.js"><link rel="prefetch" href="/assets/js/7.a7ad2d3e.js"><link rel="prefetch" href="/assets/js/70.a2538077.js"><link rel="prefetch" href="/assets/js/71.a875217e.js"><link rel="prefetch" href="/assets/js/72.98c9b7b5.js"><link rel="prefetch" href="/assets/js/73.a7f7edb4.js"><link rel="prefetch" href="/assets/js/74.21ebf589.js"><link rel="prefetch" href="/assets/js/75.c99ae9f5.js"><link rel="prefetch" href="/assets/js/76.243950ef.js"><link rel="prefetch" href="/assets/js/77.816c00e8.js"><link rel="prefetch" href="/assets/js/78.cf31f72a.js"><link rel="prefetch" href="/assets/js/79.d99185b2.js"><link rel="prefetch" href="/assets/js/8.aa3d6086.js"><link rel="prefetch" href="/assets/js/80.f7df3227.js"><link rel="prefetch" href="/assets/js/81.42a936f9.js"><link rel="prefetch" href="/assets/js/82.a978c745.js"><link rel="prefetch" href="/assets/js/83.fc4abfaf.js"><link rel="prefetch" href="/assets/js/84.93aa61f4.js"><link rel="prefetch" href="/assets/js/85.66f81fec.js"><link rel="prefetch" href="/assets/js/86.9891cfb8.js"><link rel="prefetch" href="/assets/js/87.3bf83899.js"><link rel="prefetch" href="/assets/js/88.bcd64d8f.js"><link rel="prefetch" href="/assets/js/89.ebf6b593.js"><link rel="prefetch" href="/assets/js/9.bfae8820.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3aaf8dca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">D2 Projects</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目文档" class="dropdown-title"><span class="title">项目文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/d2-admin/" class="nav-link router-link-active">d2-admin</a></li><li class="dropdown-item"><!----> <a href="/zh/document/d2-crud-v2/" class="nav-link">d2-crud v2.x</a></li><li class="dropdown-item"><!----> <a href="/zh/document/d2-crud-v1/" class="nav-link">d2-crud v1.x</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/zh/document/d2-admin/db/" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目文档" class="dropdown-title"><span class="title">项目文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/d2-admin/" class="nav-link router-link-active">d2-admin</a></li><li class="dropdown-item"><!----> <a href="/zh/document/d2-crud-v2/" class="nav-link">d2-crud v2.x</a></li><li class="dropdown-item"><!----> <a href="/zh/document/d2-crud-v1/" class="nav-link">d2-crud v1.x</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/zh/document/d2-admin/db/" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>开始使用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/document/d2-admin/" class="sidebar-link">D2Admin</a></li><li><a href="/zh/document/d2-admin/learn/start.html" class="sidebar-link">快速上手</a></li><li><a href="/zh/document/d2-admin/learn/knowledge.html" class="sidebar-link">相关知识</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>组件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>插件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vuex</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/zh/document/d2-admin/router/" class="sidebar-link">路由</a></li><li><a href="/zh/document/d2-admin/menu/" class="sidebar-link">菜单</a></li><li><a href="/zh/document/d2-admin/ajax/" class="sidebar-link">异步请求</a></li><li><a href="/zh/document/d2-admin/pages/" class="sidebar-link">多页面</a></li><li><a href="/zh/document/d2-admin/locales/" class="sidebar-link">国际化</a></li><li><a href="/zh/document/d2-admin/db/" class="active sidebar-link">数据持久化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/document/d2-admin/db/#总览" class="sidebar-link">总览</a></li><li class="sidebar-sub-header"><a href="/zh/document/d2-admin/db/#我应该选择哪种方式" class="sidebar-link">我应该选择哪种方式</a></li><li class="sidebar-sub-header"><a href="/zh/document/d2-admin/db/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/zh/document/d2-admin/db/#使用方式" class="sidebar-link">使用方式</a></li></ul></li><li><a href="/zh/document/d2-admin/css/" class="sidebar-link">CSS 实用类</a></li><li><a href="/zh/document/d2-admin/util/" class="sidebar-link">JS Util</a></li><li><a href="/zh/document/d2-admin/webpack/" class="sidebar-link">webpack</a></li><li><a href="/zh/document/d2-admin/question/" class="sidebar-link">常见问题</a></li><li><a href="/zh/document/d2-admin/other/" class="sidebar-link">其它</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据持久化"><a href="#数据持久化" class="header-anchor">#</a> 数据持久化</h1> <p>D2Admin 对数据持久化做了更清晰的包装。</p> <h2 id="总览"><a href="#总览" class="header-anchor">#</a> 总览</h2> <p>D2Admin 数据持久化依赖浏览器的 LocalStorage，使用 <a href="https://github.com/typicode/lowdb" target="_blank" rel="noopener noreferrer">lowdb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> API 加自己的取值包装实现了便捷的的操作和取值方法，通过不同的接口可以访问到持久化数据不同的内容，例如不同用户独有的存储区域，系统存储区域，公用存储，根据路由自动划分的存储区域等。</p> <p>在 <code>src/store/modules/d2admin/modules/db.js</code> 文件中提供了4组共9个方法读写持久化数据</p> <p><img src="https://qiniucdn.fairyever.com/20180820235417.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <h2 id="我应该选择哪种方式"><a href="#我应该选择哪种方式" class="header-anchor">#</a> 我应该选择哪种方式</h2> <p>有可能您会对如何选择持久化存储的 API 感到困惑，下图会帮助您在存储数据时，根据您的需要选择合适的存储方法：</p> <p><img src="https://qiniucdn.fairyever.com/20190416162535.png" alt=""></p> <p>如果是希望读取数据，依旧遵循上图的选择条件。具体的方法介绍见本页面其它章节，具体 API 详见 <a href="/zh/sys-vuex/db.html">vuex db 模块</a></p> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <p>D2Admin 数据持久化主要有以下概念：</p> <h3 id="存储实例"><a href="#存储实例" class="header-anchor">#</a> 存储实例</h3> <p>首先请先对 <a href="https://github.com/typicode/lowdb" target="_blank" rel="noopener noreferrer">lowdb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 有一定的了解，<a href="https://github.com/typicode/lowdb" target="_blank" rel="noopener noreferrer">lowdb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 通过 <a href="https://lodash.com/" target="_blank" rel="noopener noreferrer">lodash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现了对数据操作的封装，下面的例子演示了 lowdb 在浏览器中的使用方式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> low <span class="token keyword">from</span> <span class="token string">'lowdb'</span>
<span class="token keyword">import</span> LocalStorage <span class="token keyword">from</span> <span class="token string">'lowdb/adapters/LocalStorage'</span>

<span class="token keyword">const</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalStorage</span><span class="token punctuation">(</span><span class="token string">'db'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">low</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">{</span> posts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'lowdb'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>D2Admin 中的存储实例指的是上述代码中 <code>db</code> 那一步（高亮行），在获得了存储实例后你可以使用 <a href="https://lodash.com/" target="_blank" rel="noopener noreferrer">lodash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 语法直接操作存储实例，最后使用 <a href="https://github.com/typicode/lowdb" target="_blank" rel="noopener noreferrer">lowdb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的 <code>write</code> API 将变化同步回浏览器的 LocalStorage。</p> <h3 id="用户私有"><a href="#用户私有" class="header-anchor">#</a> 用户私有</h3> <p>用户私有指不同的用户使用同一个 api 访问到的存储实例指向的存储位置，例如 A 用户使用下面的代码存储了一段信息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
db
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'myName'</span><span class="token punctuation">,</span> <span class="token string">'userA'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>B 用户使用下面的代码存储了一段信息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
db
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'myName'</span><span class="token punctuation">,</span> <span class="token string">'userB'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>请注意代码的前三行都是一样的，两个用户使用的获取存储实例接口是同一个接口，只不过保存的数据不同。</p> <p>然后 A 和 B 使用同样的取值代码取值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> myName <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'myName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>这次是使用完全一样的代码，但是 A 用户登录的情况下取得的值是 <code>myName = userA</code>，B 用户登录的情况下取得的值是 <code>myName = userB</code>。</p> <p>上面介绍的特性即为“用户私有”，<strong>在 D2Admin 中，所有的数据持久化 API 都支持数据私有配置</strong>。</p> <h3 id="路由存储"><a href="#路由存储" class="header-anchor">#</a> 路由存储</h3> <p>路由存储含义和上面介绍的“用户私有”相像，区别如下：</p> <table><thead><tr><th>概念</th> <th>数据区分依据</th></tr></thead> <tbody><tr><td>用户私有</td> <td>用户 uuid</td></tr> <tr><td>路由存储</td> <td><code>route.name</code> 或者 <code>path</code> 或者 <code>fullPath</code></td></tr></tbody></table> <p>举例说明：</p> <p>在 <strong>页面1</strong> 中使用下面的代码存储一段信息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePage'</span><span class="token punctuation">)</span>
db
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'pageName'</span><span class="token punctuation">,</span> <span class="token string">'page1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>在 <strong>页面2</strong> 中使用同样的代码存储一段不同的信息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePage'</span><span class="token punctuation">)</span>
db
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'pageName'</span><span class="token punctuation">,</span> <span class="token string">'page2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>然后在 <strong>页面1</strong> 和 <strong>页面2</strong> 上使用完全相同的代码取值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePage'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pageName <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'pageName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>在 <strong>页面1</strong> 中会取到 <code>pageName = page1</code>，在 <strong>页面2</strong> 中会取到 <code>pageName = page2</code>。证明数据被依据路由划分。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>“路由存储”同时也支持“用户私有”，您可以将两者结合使用，使用下面的代码即可获得用户私有的路由存储：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePage'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="数据格式"><a href="#数据格式" class="header-anchor">#</a> 数据格式</h3> <p>首先展示完整的 D2Admin 数据存储格式：</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>不要被这张图吓到，在您使用过程中根本不会对这个结构有任何感知，API 会直接返回供您操作的节点。</p></div> <p><img src="https://qiniucdn.fairyever.com/20180821090300.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>这张图体现了数据的普通存储、用户存储、路由存储、私有路由存储、路由快照以及私有路由快照的存储位置，现在您会感觉很乱，但是请注意以下几点：</p> <ul><li>sys 模块您在业务代码中不会访问</li> <li>database 中的存储结构您绝不会使用某一个 API 全部获得，每次您操作的只是某个节点下的一部分数据，D2Admin 通过不同 API 来简化您在上述数数据中快速定位到需要的数据节点</li></ul> <h2 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> 使用方式</h2> <h3 id="root-级别方法"><a href="#root-级别方法" class="header-anchor">#</a> root 级别方法</h3> <p>root 级别的方法有两个，分别为：</p> <ul><li><a href="/zh/sys-vuex/db.html#actions-set">d2admin/db/set</a></li> <li><a href="/zh/sys-vuex/db.html#actions-get">d2admin/db/get</a></li></ul> <p>调用方式为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 写入数据</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/set'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  dbName<span class="token punctuation">:</span> <span class="token string">'database'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'demo.sometext'</span><span class="token punctuation">,</span>
  value<span class="token punctuation">:</span> <span class="token string">'Hello World'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 读取数据</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/get'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  dbName<span class="token punctuation">:</span> <span class="token string">'database'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'demo.sometext'</span><span class="token punctuation">,</span>
  defaultValue<span class="token punctuation">:</span> <span class="token string">'Hello World'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这两个方法可以在持久化数据中的任意位置（也就是上面“数据格式”章节中展示的图片上所有节点）进行读写操作，D2Admin 内部模块使用此 API 访问持久化数据，<strong>不建议在业务代码中使用</strong>，除非您非常清楚您正在做什么。</p> <h3 id="获得存储实例"><a href="#获得存储实例" class="header-anchor">#</a> 获得存储实例</h3> <p>要想向持久化数据中写入数据或者读取数据，第一步就是获得存储实例。可以通过 <code>d2admin/db/get</code> 获得存储实例。</p> <h4 id="公用"><a href="#公用" class="header-anchor">#</a> 公用</h4> <p>使用如下代码获取公用存储实例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">)</span>
</code></pre></div><p>您将获得下图所示节点（绿色高亮区域）：</p> <p><img src="https://qiniucdn.fairyever.com/20180821091548.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>写入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">)</span>
db
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'keyName'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>结果：</p> <p><img src="https://qiniucdn.fairyever.com/20180821092216.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>取值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'keyName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'value'</span>
</code></pre></div><h4 id="私有"><a href="#私有" class="header-anchor">#</a> 私有</h4> <p>如果需要，您也可以获取根据用户区分的私有存储实例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>假设当前登录用户的 uuid 为 uuid-A，您将获得下图所示节点（绿色高亮区域）：</p> <p><img src="https://qiniucdn.fairyever.com/20180821092920.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>写入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
db
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'keyName'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>结果：</p> <p><img src="https://qiniucdn.fairyever.com/20180821093132.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>取值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/database'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'keyName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'value'</span>
</code></pre></div><p>如果是不同用户分别进行了存储（获取实例方法一样，但是存储了不同的值），存储结果将是：</p> <p><img src="https://qiniucdn.fairyever.com/20180821093321.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>取值时将分别取到 value1，value2，value3</p> <h3 id="清空存储实例"><a href="#清空存储实例" class="header-anchor">#</a> 清空存储实例</h3> <p>使用下面的代码清空存储实例：</p> <h4 id="公有"><a href="#公有" class="header-anchor">#</a> 公有</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databaseClear'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="私有-2"><a href="#私有-2" class="header-anchor">#</a> 私有</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databaseClear'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="获得路由存储实例"><a href="#获得路由存储实例" class="header-anchor">#</a> 获得路由存储实例</h3> <h4 id="公用-2"><a href="#公用-2" class="header-anchor">#</a> 公用</h4> <p>假设当前页面路由信息为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'page-1'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/page1'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> component
<span class="token punctuation">}</span>
</code></pre></div><p>使用如下代码获取公用路由存储实例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePage'</span><span class="token punctuation">)</span>
</code></pre></div><p>您将获得下图所示节点（绿色高亮区域）：</p> <p><img src="https://qiniucdn.fairyever.com/20180821094404.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>写入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePage'</span><span class="token punctuation">)</span>
db
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'pageName'</span><span class="token punctuation">,</span> <span class="token string">'page-1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>结果：</p> <p><img src="https://qiniucdn.fairyever.com/20180821094549.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>取值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePage'</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'pageName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// page-1</span>
</code></pre></div><p>假设在下列页面中都进行存储操作（获取实例方法一样，但是存储了不同的值）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'page-1'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/page1'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> component
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'page-2'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/page2'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> component
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'page-3'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/page3'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> component
<span class="token punctuation">}</span>
</code></pre></div><p>结果：</p> <p><img src="https://qiniucdn.fairyever.com/20180821095545.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>三个页面取值时也会分别取到 page-1，page-2，page-3</p> <h4 id="私有-3"><a href="#私有-3" class="header-anchor">#</a> 私有</h4> <p>路由存储支持私有化，即每个用户的路由存储相互区分，使用方法和普通的路由存储基本一致，只是在获取存储实例时增加一个参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePage'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这样在每个用户进行路由存储操作的时候数据会相互隔离。</p> <p>例如 <strong>用户 A</strong> 在 <strong>页面1</strong> 中使用上述代码取得的存储实例指向位置为：</p> <p><img src="https://qiniucdn.fairyever.com/20180821100933.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p><strong>用户 B</strong> 在 <strong>页面1</strong> 中使用上述代码取得的存储实例指向位置为：</p> <p><img src="https://qiniucdn.fairyever.com/20180821101019.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>如果 <strong>用户 A</strong>，<strong>用户 B</strong> 在 <strong>页面1</strong>，<strong>页面2</strong> 分别都存储了数据，最后结果大致这样：</p> <p><img src="https://qiniucdn.fairyever.com/20180821101536.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <h3 id="清空路由存储实例"><a href="#清空路由存储实例" class="header-anchor">#</a> 清空路由存储实例</h3> <h4 id="公有-2"><a href="#公有-2" class="header-anchor">#</a> 公有</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePageClear'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="私有-4"><a href="#私有-4" class="header-anchor">#</a> 私有</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/databasePageClear'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="路由快照"><a href="#路由快照" class="header-anchor">#</a> 路由快照</h3> <p>路由快照操作相当于路由存储的一个快捷操作方式，旨在<strong>快速将当前页面的 $data 数据持久化</strong>。</p> <p>路由快照将会存储到当前路由存储的 $data 字段下。</p> <h4 id="公有-3"><a href="#公有-3" class="header-anchor">#</a> 公有</h4> <p>假设当前页面路由信息为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'page-1'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/page1'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> component
<span class="token punctuation">}</span>
</code></pre></div><p>使用如下代码存储当前页面快照：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/pageSet'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">:</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>结果：</p> <p><img src="https://qiniucdn.fairyever.com/20180821102036.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>使用如下代码将快照数据还原回页面：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 获取数据</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/pageGet'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">:</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 将数据还原到页面</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>假设在下列页面中都进行快照操作：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'page-1'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/page1'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> component
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'page-2'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/page2'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> component
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'page-3'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/page3'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> component
<span class="token punctuation">}</span>
</code></pre></div><p>每个页面的快照将会区分存放：</p> <p><img src="https://qiniucdn.fairyever.com/20180821102520.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <h4 id="私有-5"><a href="#私有-5" class="header-anchor">#</a> 私有</h4> <p>路由快照支持私有化，即每个用户的路由快照相互区分，使用方法和普通的路由快照基本一致，只是在操作快照时增加一个参数：</p> <p>存储快照：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/pageSet'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>读取快照：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 获取数据</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/pageGet'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这样在每个用户进行路由快照操作的时候数据会相互隔离。</p> <p>例如 <strong>用户 A</strong> 在 <strong>页面1</strong> 中存储了快照：</p> <p><img src="https://qiniucdn.fairyever.com/20180821103126.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p><strong>用户 B</strong> 在 <strong>页面1</strong> 中存储了快照：</p> <p><img src="https://qiniucdn.fairyever.com/20180821103205.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <p>如果 <strong>用户 A</strong>，<strong>用户 B</strong> 在 <strong>页面1</strong>，<strong>页面2</strong> 分别都存储了数据，最后结果大致这样：</p> <p><img src="https://qiniucdn.fairyever.com/20180821103306.png?imageMogr2/auto-orient/thumbnail/1480x/blur/1x0/quality/100%7Cimageslim" alt=""></p> <h3 id="路由快照清空"><a href="#路由快照清空" class="header-anchor">#</a> 路由快照清空</h3> <h4 id="公有-4"><a href="#公有-4" class="header-anchor">#</a> 公有</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/pageClear'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="私有-6"><a href="#私有-6" class="header-anchor">#</a> 私有</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'d2admin/db/pageClear'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/document/d2-admin/locales/" class="prev">国际化</a></span> <span class="next"><a href="/zh/document/d2-admin/css/">CSS 实用类</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ad93a569.js" defer></script><script src="/assets/js/2.501740d6.js" defer></script><script src="/assets/js/21.9d0f9fd3.js" defer></script>
  </body>
</html>
